Let us consider the easier version of this problem first if there are only $N - 1$ (instead of $N$) road proposals. In this case, all roads have to be constructed. Therefore, we need to find a surjective mapping from the set of road proposals to the set of workers.

We can do this by modeling a bipartite graph where we created a node for each road proposal and worker. We add an edge connecting a road proposal node and a worker node if the worker can construct the road proposal. The maximum cardinality bipartite matching should give us a surjective matching from the set of road proposals to the set of workers if it exists. We will have $O(NK)$ edges with this approach.

We can reduce the number of edges by creating a node for each material (that exists in the input) instead of for each worker. Each of these nodes has a capacity (the number of times this node can be matched) equals to the number of workers that is familiar with the material. We add an edge connecting a road proposal node and a material node if the road proposal can be constructed with the material. Since a node $u$ will be connected to $M_u$ nodes, we will have $O(\sum_{i=1}^{N} M_i)$ edges with this approach.

Now let’s get back to the original problem where we have $N$ edges. Therefore, the road proposals will contain exactly one cycle. Let’s denote $A$ as the set of road proposals inside the cycle and $B$ as the set of road proposals outside the cycle. We need to construct at least $|A| - 1$ roads in set $A$ and all roads in set $B$.

There are two ways to do this. Since we want to avoid redundant worker assignment, we want to keep at most $|A| - 1$ workers to construct the set of road proposals in $A$. Therefore, we can create an additional node (with a capacity of $|A| - 1$) that is connected to the maximum flow source and the set of road proposal nodes in $A$. Alternatively, the easier method is to run the maximum cardinality bipartite matching on set $B$ first, before running it on set $A$. We will still have $O(\sum_{i=1}^{N} M_i)$ edges with this approach.